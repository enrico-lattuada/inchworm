name: Rust CI

on:
  # Run on call from other workflows
  workflow_call:
    inputs:
      os:
        type: string
        description: 'Operating system to use'
        required: false
        default: 'ubuntu-latest'
  # Manual trigger
  workflow_dispatch:

env:
  RUSTFLAGS: -C debuginfo=0  # Do not produce debug symbols to keep memory usage down
  RUST_BACKTRACE: 1

jobs:
  rust:
    name: Lint, Build & Test (${{ inputs.os }})
    runs-on: ${{ inputs.os }}
    steps:
      - name: ğŸ” Checkout Code
        uses: actions/checkout@v6

      - name: ğŸ¦€ Set up Rust
        run: rustup component add clippy

      - name: â˜‘ï¸ Run Clippy Check
        run: cargo clippy --workspace --all-targets --all-features -- -D warnings

      - name: ğŸ—ï¸ Compile Tests
        run: cargo test --workspace --all-features --no-run

      - name: ğŸ§ª Run Tests
        run: cargo test --workspace --all-features --no-fail-fast --color=always
